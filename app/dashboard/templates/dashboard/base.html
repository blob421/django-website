<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
     {% load static %}
     <link rel="stylesheet" href="{% static 'dashboard/team_vs.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/home.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/messages.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/msg_main.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/tasks.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/team.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/management/management.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/management/tasks.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/management/schedules.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/chat.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/inbox.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/charts.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/schedules.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/account.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/history.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/resources.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/reports.css' %}">
     <link rel="stylesheet" href="{% static 'dashboard/base/base.css' %}">

    <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.9/dist/inputmask.min.js"></script>

     <script src="{% static 'js/getSubtask.js' %}"></script>
     
     {% block extra_css %}
     {% endblock %}

</head>

<body>

<div class="nav_container"> 
<nav class="nav_top">
  
  <a href="{% url 'dashboard:home' %}">Home</a>
  <a href="{% url 'dashboard:messages' %}">Messages</a>
  {% if new > 0 %}<div class="new_msg_count_div">{{new}}</div>{% endif %}
  <a href="{% url 'dashboard:tasks_list' %}">Tasks</a>
  <a href="{% url 'dashboard:projects' %}">Projects</a>
   
  <a href="{% url 'dashboard:team' %}">Team</a>

  <a href="{% url 'dashboard:chat_view' %}">Chat</a>
  <button onclick="setVisible(this,'shade_logout')">Logout</button> 
  {% if is_home %}
  <a href="{% url 'dashboard:user_account' user.id %}" class="userprofile_nav">User profile</a>
  {% endif %}


</nav>
</div>
{% load static %}

<a href="{% url 'dashboard:ressources' %}">
 <img src= "{% static 'question_mark.png' %}" id="question_mark">
 </a>

<div id="shade_logout">
  
<div id="report_modal">

    <div class="logout_x_btn" 
    onclick="document.getElementById('shade_logout').style.display='none'">
    X
    </div>

    <form method="post" action='{% url "dashboard:logout" %}'>
      {% csrf_token %}
       <div class="logout_title">
        Logout ?

       </div> 
        <div class="logout_modal_btn_cont">
          <a href="{% url 'dashboard:report' %}" class="report_btn">
          <button type="button">Do your report</button>
          </a>

          <button type="submit" class="logout_modal_btn"> Logout </button>
       </div>

    </form>
</div>

</div>


{% if user.userprofile.active_task %}
<a href="{% url 'dashboard:task_detail' user.userprofile.active_task.id %}" class="go_to_active">
  Active task
</a>

{% endif %}
 {% block content %}{% endblock %}


<!--------------------------------NOTIF MODAL---------------------------------------->

<div class="notif_div" id=notif>
  
  
</div>

<!------------------------------------------------------------------------------------>
<script>
const socket = new WebSocket('ws://127.0.0.1:8000/ws/test/');

socket.onopen = () => {
  console.log('WebSocket connection established');
};

socket.onmessage = (event) => {
  const notif = document.getElementById('notif')
  const data = JSON.parse(event.data);
  console.log('Received:', data.message);  
  if (data.message !== 'WebSocket connected'){

    if (data.type == 'message'){

      notif.innerHTML += 
    `<div id="notifBubble${data.message.id}" class="notifBubble">
         
      <button class="x_btn_notif" onclick="document.getElementById(
        'notifBubble${data.message.id}').style.display='none'">X 
      </button> 
      <div class="notif_header">
          <img src="{% static 'msg_icon.png' %}" style="width:20%">
          <div class="right_header_notif">
              <div>
                New message
              </div>
              <div class="from_text_notif">
                From ${data.message.sender}
              </div>
          </div>
   
      </div>
         
      <div class="notif_content">
          ${data.message.content}
      </div>
      
      
    </div>`

    }

    }


    

};

socket.onclose = () => {
  console.log('WebSocket connection closed');
};

socket.onerror = (error) => {
  console.error('WebSocket error:', error);
};

</script>
</body>