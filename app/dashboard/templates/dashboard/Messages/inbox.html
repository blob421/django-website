
 {% include 'dashboard/base.html' %}

 {% block content %}


  <div class="center_container">
    
       {% if user.is_authenticated %}
       <div class="title_container_inbox">  <h1 class="home_head">Inbox</h1></div>
       {% endif %}


       <div class="btn-container-msg">
     <div class="messages_send_msg_btn">
      
      <a href="{% url 'dashboard:messages_create' %}">
        <button class="send_a_msg_btn">Send a message</button></a></div>
       <form id="myForm" method="post">
               {% csrf_token %}
        <!-- Hidden inputs will be added here -->
        <button type="submit" class="view_a_msg_btn">Delete selected</button>
      </form>

      </div>


     



      <div class="text_container_inbox">
        
<div class="form_seach_container">  

        <form class="search_bar_inbox">
       <input type="text" placeholder="Search.." name="search"
          {% if search %} value="search" {% endif %} class="search_bar_input">
     <button class="search_inbox_btn" type="submit">Search / Clear</button>
        </form>
</div>


     {% if not messages %}
     <p class="no_messages"> No messages for the moment</p>
     {% endif %}
      
      <div class="bubble_wrapper_inbox"> 
    <div class="bubbles_div_inbox">
      {% if messages %}
      {% for message in messages %}
  

      
      <div class="msg_button_inbox">
    
    <div class="text_div_bubble_inbox">
        
      <a href="{% url 'dashboard:reportview' message.id %}" class="bubble_link_inbox"> 
      {% if not message.forwarded %}
      <div class="msg_content_inbox"><strong>{{message.user}}: </strong>{{message.title}} </div> </a>
       </div>
       {% else %}
        <div class="msg_content_inbox"><strong>{{message.forwarded_by}}: </strong>
          {{message.title}}<strong><em> (forwarded from {{message.user}})  </em></strong> </div> </a>
       </div>
       {% endif %}
      <p class="msg_date">{{message.timestamp}}</p>
      <a href="{% url 'dashboard:message_forward' message.id %}" class="delete_bubblex_inbox">
         <div class="bubblex_radius_inbox"> > </div> </a>
     

   
            <div class="tickbox" onclick="fillbox('{{message.id}}');selectBox(this)" id="{{message.id}}"></div>
       </div>
      
      {% endfor %}
   
      
      {% endif %}
       </div>
      </div>
      </div>
   </div>



   <div class="send_msg_back">
   <a href="{% url 'dashboard:messages' %}"><button class="del_btn2" type="button">Back</button></a>

 </div>
 {% endblock %}



<script>


function fillbox(n) {
 
  const box = document.getElementById(n);
  const selected = box.getAttribute('is_selected') === 'true';

  if (selected){
    box.style.backgroundColor='transparent';
    box.setAttribute('is_selected', 'false');
    
  }

  else {
   box.style.backgroundColor = '#B5D4F4'
   box.setAttribute('is_selected', 'true');
  }
}


function selectBox(element) {
  const form = document.getElementById('myForm');
  const boxId = element.id;

  // Toggle selection style
  element.classList.toggle('selected');

  // Check if already selected
  const existingInput = document.getElementById('input_' + boxId);

  if (element.classList.contains('selected')) {
    // Add hidden input to form
    if (!existingInput) {
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'selected_boxes';  // Pass as array
      input.value = boxId;
      input.id = 'input_' + boxId;
      form.appendChild(input);
    }
  } else {
    // Remove hidden input if deselected
    if (existingInput) {
      form.removeChild(existingInput);
    }
  }
}

</script>

