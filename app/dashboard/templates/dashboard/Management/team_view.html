 {% extends 'dashboard/base.html' %}
 {% load static user_data %}
 {% block content %}



 <h1 class="team_title">{{user.userprofile.team.name}} management</h1>

<div class="border_container"> 
      <div class="team_second_title">
            <button onclick="setVisible(this, 'team_tasks', 'team_all_task_list')" 
            id="toggle_manage" class="management_tog_btn">
               Employee / Tasks
            </button>
            <button onclick="setVisible(this, 'team_all_task_list', 'team_tasks')" 
            id="toggle_manage" class="management_tog_btn">
               Task list
            </button>

     </div>
     <div class="nav_cont">
         
               <button class="scroll_not_manage" onclick="scrollToBot('team_tasks', 'team_all_task_list')"> ▼
               </button>
               <button class="scroll_not_manage" onclick="scrollRight('team_tasks')">▶</button>
               <button class="scroll_not_manage" onclick="reset('team_tasks', 'team_all_task_list')">Reset</button>
     </div>
</div>
 <div class="team_container1">


<div id="team_all_task_list">

      <div class="manage_all_task_list_container_title">
          <div class="manage_all_task_list_name_title">Task name</div>
            
          <div class="manage_all_task_list_date_title">Due date</div>

     </div>
     {% for task in tasks %}
     <a href="{% url 'dashboard:task_manage_update' task.id %}"> 
     <div class="manage_all_task_list_container">
               <div class="manage_all_task_list_name">{{task.name}} </div>
            
               <div class="manage_all_task_list_date {% if task.due_date < time %}
                  manage_all_task_list_date_late {% endif %}">{{task.due_date}}</div>
     </div>
     </a>
     {% endfor %}



</div>

<div class="team_tasks" id="team_tasks">



{% for member in team %}
<div class="team_member_rows">
<a href="{% url 'dashboard:perf_detail' member.id %}" class="team_name_container">{{member.user.username}} ({{member.role.name}})</a>
{% for task in member.task_users.all %}



{% if task.due_date < time %}
 {% with task|getUserCount as count %}
<div class="tasks_units_blocks_denied">
         <a class="link_management" href="{% url 'dashboard:task_manage_update' task.id %}">
            {{task.name}}
         </a>
         <div class="icons_manage">
            <div class="people_img_div_man">
            {{count}}
               
            <img src="{% static 'team_icon14.png' %}" class="people_img" id="people{{task.id}}"
            data-member="{{task|get_team}}">
            </div>
           
            {% if task.section %}
            
            <div class="chart_icon_div"> 
            <img src="{% static 'chart_icon4.png' %}" id="chart_img{{task.id}}" class="chart_img"
                  onclick="info('{{task.chart.title}}')"
                  data-title="{{task.chart.title}}">
            </div>
            {% endif %}

         </div>
</div>
{% endwith %}
{% elif not task.completed %}
 {% with task|getUserCount as count %}
<div class="tasks_units_blocks">
     
         <a class="link_management" href="{% url 'dashboard:task_manage_update' task.id %}">
         {{task.name}}
         </a>

         <div class="icons_manage">
              <div class="people_img_div_man">
            {{count}}
               
            <img src="{% static 'team_icon14.png' %}" class="people_img" id="people{{task.id}}"
            data-member="{{task|get_team}}">
            </div>
          
            {% if task.section %}
            
            <div class="chart_icon_div"> 
            <img src="{% static 'chart_icon4.png' %}" id="chart_img{{task.id}}" class="chart_img"
                  onclick="info('{{task.chart.id}}')"
                   data-title="{{task.chart.title}}">
            </div>
            {% endif %}

         </div>
</div>

{% endwith %}
{% else %}
<div class="tasks_units_blocks_completed">
   <a class="link_management" href="{% url 'dashboard:task_manage_update' task.id %}">
      {{task.name}}
   </a>




</div>
{% endif %}


{% endfor %}
</div>
{% endfor %}




</div> 


<div class="team_management"> 



<div class="btn-div">  
 <a href="{% url 'dashboard:task_manage_create' %}"> 
    <button class="button_tasks_list" type="button">New task</button>
 </a>
</div>

<div class="btn-div3">
<a href="{% url 'dashboard:team_completed' %}"> 
<button class="button_tasks_list">Review tasks</button>
</a>   
</div>
<div class="btn-div4">
   ({{count}}) new tasks 
</div>


<div class="btn-div2">
<a href="{% url 'dashboard:team_update' user.userprofile.team.id %}">
<button type="button" class="button_tasks_list">Pin a message for the team</button>
</a>
</div>

<div class="btn-div-5">
   <a href="{% url 'dashboard:schedule_manage' %}"><button type="button" class="button_tasks_list">Schedules </button>
</a>

</div>

<div class="btn_div_6">
   <a href="{% url 'dashboard:perf_team' user.userprofile.team.id %}"> <button class="button_tasks_list"> Performance metrics</button></a>

</div>

</div>
</div>

       <div id="info_modal_team">
         <div class="team_list_title">
             Team

         </div>
         <div id="text_team"></div>
          
       </div>
         



      <div id="info_modal">
         
         <p id="text_value">
            Go to chart

         </p>
         </div>



<script>
function info(id){
 window.location.href=`/dashboard/projects/chart/${id}`
}

document.addEventListener('DOMContentLoaded', () => {
   const chart_icon = document.querySelectorAll('[id^=people]');  
   const text_div = document.getElementById('text_team') 
   
   chart_icon.forEach(icon => {
   const info = document.getElementById('info_modal_team');

   icon.addEventListener('mouseenter', () => {
        
          const rect = icon.getBoundingClientRect();

            //Set and calculate dimensions 
            text_div.innerHTML= icon.dataset.member
            info.style.visibility = 'hidden';
            info.style.display = 'block';

            let top = rect.bottom 
            let left = rect.left + 20;
        
            const modalWidth = info.offsetWidth;
            const modalHeight = info.offsetHeight;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            if (left + modalWidth > viewportWidth) {
               left = viewportWidth - modalWidth - 10;
            }

            const modalBottom = top + modalHeight;
            const maxBottom = window.innerHeight;

            if (modalBottom > maxBottom) {
            top = rect.top - modalHeight - 10; // flip above
            }
            info.style.visibility = 'visible';
          
            // Apply position
            info.style.position = 'absolute';
            info.style.top = `${top}px`;
            info.style.left = `${left}px`;
            info.style.display = 'block';
            });

      icon.addEventListener('mouseout', () => {
         info.style.display ='none';
      });
   });
});




document.addEventListener('DOMContentLoaded', () => {
   const chart_icon = document.querySelectorAll('[id^=chart_img]');
   const info = document.getElementById('info_modal');
   const text_div = document.getElementById('text_value') 
   chart_icon.forEach(icon => {
      text_div.innerText= icon.dataset.title
      icon.addEventListener('mouseenter', () => {
          const rect = icon.getBoundingClientRect();
               info.style.position = 'absolute';
               info.style.top = `${rect.bottom - 10}px`;
               info.style.left = `${rect.left + 22}px`;
    
               info.style.display='flex';
               info.innerText = title

      });
      icon.addEventListener('mouseout', () => {
         info.style.display ='none';
      });
   });
})


 function scrollToBot(elem1, elem2) {
  const div1 = document.getElementById(elem1);
  const div2 = document.getElementById(elem2);

  if (div1) {
    div1.scrollTo({
      top: div1.scrollHeight,
      behavior: 'smooth'
    });
  }

  if (div2) {
    div2.scrollTo({
      top: div2.scrollHeight,
    
      behavior: 'smooth'
    });
  }
}
  function scrollRight(elem) {
     const div = document.getElementById(elem);
 
    div.scrollTo({
      left: div.scrollWidth,
      behavior: 'smooth' 
      
    });
 
  }

function reset(elem1, elem2) {
  const div1 = document.getElementById(elem1);
  const div2 = document.getElementById(elem2);

  if (div1) {
    div1.scrollTo({
      top: 0,
      left: 0,
      behavior: 'smooth'
    });
  }

  if (div2) {
    div2.scrollTo({
      top: 0,
      left: 0,
      behavior: 'smooth'
    });
  }
}
</script>






 {% endblock %}
